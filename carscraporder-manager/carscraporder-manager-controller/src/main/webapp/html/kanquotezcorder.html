<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" href="../lookpic/dist/zoomify.min.css" />
    <link rel="stylesheet" href="../layui/css/layui.css" />
    <script src="../js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/dropdown.js" type="text/javascript"></script>
    <script src="../layui/layui.all.js" type="text/javascript"></script>
    <script src="../lookpic/dist/zoomify.min.js"></script>

    <style>
        .thumbnail img {
            width: 133px;
            height: 77px;
        }
    </style>
    <title>车互联-整车报废</title>
</head>
<body>
    <div class="back-stage-top">
        <h1 class="pull-left">车报废管理后台</h1>
        <h1 class="pull-right text-primary" id="loginout" style="margin-left:20px;cursor:pointer;font-size:18px;margin-right:50px;" onclick="loginout()">退出</h1>
        <h1 class="pull-right text-primary" id="loginusername" style="margin-left:20px;font-size:18px;">用户名：张三</h1>
    </div>
    <div class="backnav">
        <ul class="backnav" id="backnavper">
            <li class="displaynone"><a href="index.html">首页</a></li>
            <li class=""><a href="Inquiry.html">询价管理</a></li>
            <li class="cur displaynone"><a href="orderquotelist.html">报价管理</a></li>
            <li class="displaynone"><a href="orderlist.html">订单管理</a></li>
            <li class="displaynone"><a href="scraplist.html">整车报废</a></li>
            <li class="displaynone"><a href="jiulist.html">旧件回收</a></li>
            <li class="displaynone"><a href="moneymanage.html">财务管理</a></li>
            <li class="displaynone"><a href="system.html">系统管理</a></li>
        </ul>
    </div>
    <div class="formbox">
        <div class="tablebox">
            <ol class="breadcrumb m-t-10">
                <li><a href="index.html">首页</a></li>
                <li><a href="orderquotelist.html">报价管理</a></li>
                <li>处理订单</li>
            </ol>
            <!--end 流程图-->
            <div class="row">
                <!--车辆信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">车牌号：</th>
                            <td><span id="carnum"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车架号：</th>
                            <td><span id="carjia"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆型号：</th>
                            <td><span id="carxing"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">能否行驶：</th>
                            <td><span id="isdrive"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆归属：</th>
                            <td><span id="carAscription"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车主姓名：</th>
                            <td><span id="carOwner"></span></td>
                        </tr>
                    </table>
                </div>
                <!--end 车辆信息-->
                <!--取车信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 取车信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">取车联系人：</th>
                            <td><span id="takeCarContacts"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">联系人电话：</th>
                            <td><span id="takeCarContactNumber"></span></td>
                        </tr>

                        <tr>
                            <th width="120" class="text-right">取车时间：</th>
                            <td><span id="takeCarTime"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">取车地址：</th>
                            <td><span id="takeCarAddress"></span></td>
                        </tr>
                    </table>
                </div>
                <!--end 取车信息-->
                <!--报废图片-->
                <div class="clearfix"></div>
                <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆与手续照片</h4>
                <div class="col-md-12">
                    <div class="displaypics">
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="col-md-6" style="padding-left:20px;">
                    <div id="BranchQuoteID" style="font-size:24px;min-width:250px;float:left;font-weight:bold;display:none;">
                       
                    </div>
                    <div id="CorporationQuoteID" style="font-size:24px;min-width:250px;float:left;font-weight:bold;display:none;">

                    </div>
                    <div id="QuoteID" style="display:none;">
                        <label style="font-size:24px;float:left;">报价：</label>
                        <input class="form-control" id="VehicleQuoteID" onkeyup="VerifyAmount(this)" style="width:200px;float:left;" placeholder="请输入价格" type="text" />
                    </div>
                </div>
            </div>
            <div class="page-header"></div>
            <div class="text-center" style="margin-bottom:10px;">
                <a href="javascript:SubQuote();" id="SubOK" class="btn btn-default" style="width:89px;background-color:#3598dc;color:white;display:none;">提交</a>
                <a href="orderquotelist.html" class="btn btn-default goback" style="width:89px;">返回</a>
                <p></p>
            </div>
        </div>
    </div>

    <script src="../js/modal.js" type="text/javascript"></script>
    <script src="../js/comm.js" type="text/javascript"></script>
    <script src="../layui/layui.all.js"></script>
    <script>
        var _cityname = localStorage.getItem("cityname");
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);
        var id = $.getUrlParam('id');
        LoadPageDetail(id);
        function LoadPageDetail(id) {
            $.ajax({
                type: "get",
                url: href + 'order/' + id,
                dataType: "json",
                async: false,
                success: function (obj) {
                    if (obj.code == "201") {
                        layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "login.html";
                        });
                        return false;
                    }
                    if (obj.msg == "success") {
                        console.log(obj);
                        var info = obj.data;
                        $("#carnum").html(info.carNumber);
                        $("#carjia").html(info.carFrameNumber);
                        $("#carxing").html(info.carModelNumber);
                        $("#isdrive").html(info.isdrive == "1" ? "可以行驶" : (info.isdrive == "2" ? "不可以行驶" : "严重事故"));
                        $("#carAscription").html(info.carAscription == "1" ? "个人" : "公户");
                        $("#carOwner").html(info.carOwner);
                        $("#payeeName").html(info.payeeName);
                        $("#bankAccount").html(info.bankAccount);
                        $("#openingBank").html(info.openingBank);
                        $("#orderAmount").html(info.orderAmount);
                        $("#amountstate").html(GetAmountState(info.orderStatus));
                        $("#takeCarContacts").html(info.takeCarContacts);
                        $("#takeCarContactNumber").html(info.takeCarContactNumber);
                        $("#takeCarTime").html(info.takeCarTime);
                        $("#takeCarAddress").html(info.takeCarAddress);
                        $("#mailingAddressName").html(info.mailingAddressName);
                        $("#mailingAddressTelephone").html(info.mailingAddressTelephone);
                        $("#expressCompany").html(info.expressCompany);
                        $("#expressNumber").html(info.expressNumber);
                        $("#BranchQuoteID").html("分公司报价：" + info.subQuote);
                        $("#CorporationQuoteID").html("总公司报价：" + info.orderAmount);
                        if (info.orderStatus == 11){
                            $("#QuoteID").show();
                            $("#SubOK").show();
                        }
                        else if (info.orderStatus == 12) {
                            $("#BranchQuoteID").show();
                            if (_cityname.indexOf("总部") >= 0) {
                                $("#QuoteID").show();
                                $("#SubOK").show();
                            }
                        }
                        else{
                            $("#BranchQuoteID").show();
                            $("#CorporationQuoteID").show();
                        }
                        var pics = info.vehiclePictures;
                        var picinfo = "";
                        for (i = 0; i < pics.length; i++) {
                            if (pics[i].carPictureType) {
                                picinfo += '<div class="col-xs-2 col-md-2">';
                                picinfo += '<div class="thumbnail">';
                                picinfo += '<img src="' + pics[i].url + '" alt="" />';
                                picinfo += '<p class="m-t-10 text-center text-primary">' + GetPicCategory(pics[i].carPictureType) + '</p>';
                                picinfo += '</div>';
                                picinfo += '</div>';
                            }
                        }
                        pics = info.formalitiesPictures;
                        for (i = 0; i < pics.length; i++) {
                            if (pics[i].carPictureType) {
                                picinfo += '<div class="col-xs-2 col-md-2">';
                                picinfo += '<div class="thumbnail">';
                                picinfo += '<img src="' + pics[i].url + '" alt="" />';
                                picinfo += '<p class="m-t-10 text-center text-primary">' + GetPicCategory(pics[i].carPictureType) + '</p>';
                                picinfo += '</div>';
                                picinfo += '</div>';
                            }
                        }
                        $("#detailedAddress").html(LoadProvince(info.province) + LoadCity(info.city) + LoadArea(info.county) + info.detailedAddress);
                        //加载图片
                        $(".displaypics").html(picinfo);
                        //初始化话图片
                        $(".thumbnail img").zoomify();
                    }
                }
            })
        }

        //加载省份
        function LoadProvince(a) {
            var result = "";
            if (a) {
                $.ajax({
                    type: "get",
                    url: href + "provinces/" + a,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.code == "201") {
                            layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "login.html";
                            });
                            return false;
                        }
                        if (obj.msg == "success") {
                            result += obj.data.province;
                        }
                    }
                });
            }
            return result;
        }
        //加载城市
        function LoadCity(b) {
            var result = "";
            if (b) {
                $.ajax({
                    type: "get",
                    url: href + "cityes/" + b,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.msg == "success") {
                            result += obj.data.city;
                        }
                    }
                });
            }
            return result;
        }
        //加载区域
        function LoadArea(c) {
            var result = "";
            if (c) {
                $.ajax({
                    type: "get",
                    url: href + "areas/" + c,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.msg == "success") {
                            result += obj.data.area;
                        }
                    }
                });
            }
            return result;
        }

        //根据订单状态返回残值金额状态
        function GetAmountState(a) {
            var result = "";
            if (a == "1" || a == "2" || a == "3" || a == "4" || a == "5") {
                result = "未支付";
            }
            else if (a == "6") {
                result = "部分支付";
            }
            else if (a == "6") {
                result = "已支付";
            }
            else {
                result = "订单异常";
            }
            return result;
        }

        //加载图片所属类型
        function GetPicCategory(a) {
            var result = "";
            switch (a) {
                case "1": result = "左前45度"; break;
                case "2": result = "正前"; break;
                case "3": result = "右前45度 "; break;
                case "4": result = "左后45度"; break;
                case "5": result = "正后"; break;
                case "6": result = "右后45度"; break;
                case "7": result = "车架号"; break;
                case "8": result = "发动机"; break;
                case "9": result = "仪表"; break;
                case "10": result = "行驶证"; break;
                case "11": result = "登记证"; break;
                case "12": result = "车主身份正正前方"; break;
                case "13": result = "车主身份正正后"; break;
                default: result = "";
            }
            return result;
        }

        //返回
        $(".goback").on("click", function (event) {
            event.preventDefault();
            window.history.go(-1)
        });
        ///提交报价
        function SubQuote() {
            var Quote = $("#VehicleQuoteID").val();
            if (Quote == "") {
                layer.msg("请输入报价！");
            }
            else {
                $.ajax({
                    type: "put",
                    url: href + "order/quote",
                    data: { id: id, orderType: 1, amount: Quote },
                    dataType: "json",
                    success: function (data) {
                        if (data.code == "201") {
                            layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "login.html";
                            });
                            return false;
                        }
                        if (data.code == "200") {
                            if (data.data) {
                                layer.msg("报价成功！", {time:700}, function () {
                                    window.location.href = "orderquotelist.html";
                                });
                            }
                            else {
                                layer.msg("报价失败！");
                            }
                        }
                        else {
                            layer.msg("数据异常！");
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>
