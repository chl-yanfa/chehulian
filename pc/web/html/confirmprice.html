<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../layui/css/layui.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" href="../lookpic/dist/zoomify.min.css" />
    <script src="../js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/jquery.bootstrap.min.js"></script>
    <script src="../js/dropdown.js" type="text/javascript"></script>
    <script src="../js/modal.js" type="text/javascript"></script>
    <script src="../layui/layui.all.js"></script>
    <script src="../lookpic/dist/zoomify.min.js"></script>

    <title>车互联-整车报废</title>
</head>
<body class="bg">
    <div class="topbar">
        <div class="pull-right text-primary" id="loginout" style="margin-left:20px;cursor:pointer;" onclick="loginout()">退出</div>
        <div class="pull-right text-primary" id="loginusername" style="margin-left:20px;"></div>
        <div class="pull-right text-primary" id="loginphonenum"></div>
        <div class="logo"><img src="../img/logo.png" title="" /></div>
        <div class="topcity pull-left">
            <div class="m-b-20">
                <span class="text-primary firstcity pull-left m-r-10 m-l-15"></span>
                <input type="hidden" value="" id="firstcityid" />
                <div class="dropdown pull-left">
                    <div id="changecity" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        [ 切换城市 <span class="caret"></span> ]
                    </div>
                    <ul class="dropdown-menu" aria-labelledby="changecity"></ul>
                </div>
                <div class="clearfix"></div>
            </div>
            <ul class="nav nav-pills topnav">
                <li role="presentation"><a href="index.html">首页</a></li>
                <li role="presentation" class="kzper1" style="display:none;"><a href="scraplist.html">整车报废</a></li>
                <li role="presentation" class="active kzper2" style="display:none;"><a href="reclaimlist.html">旧件回收</a></li>
                <li role="presentation"><a href="partstrading.html">配件交易</a></li>
                <li role="presentation"><a href="auctionhouse.html">拍卖大厅</a></li>
                <li role="presentation"><a href="questions.html">常见问题</a></li>
                <li role="presentation"><a href="aboutus.html">关于我们</a></li>
                <li role="presentation"><a href="mycenter.html">个人中心</a></li>
            </ul>
        </div>
    </div>
    <div class="formbox">
        <div class="tablebox">
            <ol class="breadcrumb">
                <li><a href="reclaimlist.html">旧件回收</a></li>
                <li class="active">确定价格</li>
            </ol>
            <div class="row">
                <!--车辆信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">订单编号：</th>
                            <td><span class="ordnum"></span></td>
                        </tr>
                        <tr id="trcarnumid">
                            <th width="120" class="text-right">车牌号：</th>
                            <td><span class="carnum"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车架号：</th>
                            <td><span class="carjia"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆型号：</th>
                            <td><span class="carxing"></span></td>
                        </tr>
                        <tr id="trcarbaoid">
                            <th width="120" class="text-right">报案号：</th>
                            <td><span class="bao"></span></td>
                        </tr>
                    </table>
                </div>
                <!--end 车辆信息-->
                <!--取车信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 取车信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">取车联系人：</th>
                            <td><span class="carman"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">联系人电话：</th>
                            <td><span class="carphone"></span></td>
                        </tr>

                        <tr>
                            <th width="120" class="text-right">取车时间：</th>
                            <td><span class="cartime"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">取车地址：</th>
                            <td><span class="caraddress"></span></td>
                        </tr>
                    </table>
                </div>
                <div class="clearfix"></div>
                <!--end 取车信息-->
                <div class="col-lg-12">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 配件信息</h4>
                    <table class="table  showtab">
                        <thead>
                            <tr>
                                <th width="120">配件分类</th>
                                <th width="120">配件名称</th>
                                <th width="120">零件编号</th>
                                <th width="100px">描述</th>
                                <th width="10%">备注</th>
                                <th width="30%">配件照片</th>
                                <th width="100">残值金额</th>
                                <th width="150"></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="page-header"></div>
            <div class="text-center m-b-20">
                <button class="btn btn-primary btn-lg" id="Confirmed" style="width:89px;">确认</button>
            <button class="btn btn-default btn-lg goback"  style="width:89px;">返回</button>
            </div>
        </div>
    </div>
    <script src="../js/comm.js"></script>
    <script type="text/javascript">
        (function ($) {
            if (localStorage.userType == 1) {
                $("#trcarnumid").hide();
                $("#trcarbaoid").hide();
            }
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);
        var id = $.getUrlParam('id');
        $.ajax({
            type: "get",
            url: href + 'order/' + id,
            dataType: "json",
            success: function (data) {
                if (data.code == "201"){
                    layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                        time: 1000, //2s后自动关闭
                    }, function () {
                        window.location.href = "login.html";
                    });
                    return false;
                }
                if (data.msg == "success") {
                    var d = data.data;
                    $(".ordnum").html(d.orderNo);
                    $(".carnum").html(d.carNumber);
                    $(".carjia").html(d.carFrameNumber);
                    $(".carxing").html(d.carModelNumber);
                    $(".bao").html(d.reportNo);
                    $(".du").html(GetOldStateMsg(d.orderStatus));
                    $(".carman").html(d.takeCarContacts);
                    $(".carphone").html(d.takeCarContactNumber);
                    $(".cartime").html(d.takeCarTime);
                    $(".caraddress").html(d.takeCarAddress);
                    var dd = d.carScrapOrderAutopartsList;
                    var amount = 0;
                    if (dd.length) {
                        var otr = "";
                        for (var i = 0; i < dd.length; i++) {
                            amount += dd[i].amount;
                            otr += '<tr>'
                            otr += '<td>' + dd[i].partsCaregoryName + '</td>'
                            otr += '<td>' + dd[i].partsTypeName + '</td>'
                            otr += '<td>' + dd[i].partsNum + '</td>'
                            var _miaoshu = "";
                            if (dd[i].isDismantle == "Y") {
                                _miaoshu = _miaoshu + "、纯拆";
                            }
                            if (dd[i].isCollision == "Y") {
                                _miaoshu = _miaoshu + "、碰撞";
                            }
                            if (dd[i].isWear == "Y") {
                                _miaoshu = _miaoshu + "、自然磨损";
                            }
                            if (dd[i].isFlood == "Y") {
                                _miaoshu = _miaoshu + "、水淹";
                            }
                            if (_miaoshu != "")
                                _miaoshu = _miaoshu.substring(1);
                            otr += '<td>' + _miaoshu + '</td>';
                            otr += '<td>' + dd[i].remark + '</td>';
                            var pics = dd[i].autoPartsPictures;
                            var obj = "";
                            var urls = [], ids = [];
                            if (pics.length) {
                                for (var j = 0; j < pics.length; j++) {
                                    urls.push(pics[j].url);
                                    ids.push(pics[j].id)
                                    obj += '<div>'
                                    obj += '<div ><img class="img-rounded" style="float:left;width:120px;height:90px;margin-left:10px" src="' + pics[j].url + '" /></div>'
                                    obj += '</div>'
                                }
                            };
                            var urrs = urls.join();
                            var idss = ids.join();
                            otr += '<td> <div class="row">' + obj + '</div></td>'
                            otr += '<td>' + dd[i].amount + '</td>';
                            otr += '<td><label><input name="Fruit' + i + '" type="radio" data-id="' + dd[i].id + '" checked value="0" />接收 </label> <label><input name="Fruit' + i + '" data-id="' + dd[i].id + '" type="radio" value="1" />不接受 </label> </td>'
                            //otr += '<td>' + dd[i].sortingState + '这里接口没有说明</td>';
                            otr += '</tr>';

                        };
                        $(".canmoney").html(amount.toFixed(2) + "  元");
                        $(".showtab tbody").html(otr);
                        for (var i = 0; i < $(".showtab td").length; i++) {
                            if ($(".showtab td").eq(i).text() == null || $(".showtab td").eq(i).text() == "null") {
                                $(".showtab td").eq(i).html("")
                            }
                        }
                        //初始化话图片
                        $(".showtab tbody  img").zoomify();
                    }
                }
            }
        });
        //返回
        $(".goback").on("click", function (event) {
            event.preventDefault();
            window.history.go(-1)
        });
        $("#Confirmed").on("click", function (event) {
            event.preventDefault();
            var trs = $(".showtab tbody tr");
            if (trs.length > 0) {
                var arr = [];
                for (var i = 0; i < trs.length; i++) {
                    var tr = trs[i];
                    var radio = $(tr).find(':radio:checked');
                    arr.push({
                        id: radio.attr("data-id"),
                        amountIsaccept: radio.val()
                    });
                }
                var senddata = {
                    id: id,
                    orderType: 2,
                    carScrapOrderAutopartsList: arr
                }
                $.ajax({
                    type: "put",
                    url: href + "order/confirmAmount",
                    data: JSON.stringify(senddata),
                    contentType: "application/json;charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.code == "201") {
                            layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "login.html";
                            });
                            return false;
                        }
                        if (data.msg == "success") {
                            layer.msg('<span style="font-size:20px">确认成功</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "reclaimlist.html";
                            });
                        }
                    }
                });
            }
            else {
                layer.msg('<span style="font-size:20px">没有找到数据</span>');
            }
        });
    </script>
</body>
</html>
