<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../lookpic/dist/zoomify.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../layui/css/layui.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/pagination.css" />
    <script src="../js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/dropdown.js" type="text/javascript"></script>
    <script src="../js/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
    <script src="../lookpic/dist/zoomify.min.js"></script>
    <style>
        .thumbnail img {
            width: 133px;
            height: 77px;
        }
    </style>
    <title>车互联-整车报废</title>
</head>
<body class="bg">
    <div class="topbar">
        <div class="pull-right text-primary" id="loginout" style="margin-left:20px;cursor:pointer;" onclick="loginout()">退出</div>
        <div class="pull-right text-primary" id="loginusername" style="margin-left:20px;"></div>
        <div class="pull-right text-primary" id="loginphonenum"></div>
        <div class="logo"><img src="../img/logo.png" title="" /></div>
        <div class="topcity pull-left">
            <div class="m-b-20">
                <span class="text-primary firstcity pull-left m-r-10 m-l-15"></span>
                <input type="hidden" value="" id="firstcityid" />
                <div class="dropdown pull-left">
                    <div id="changecity" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        [ 切换城市 <span class="caret"></span> ]
                    </div>
                    <ul class="dropdown-menu" aria-labelledby="changecity"></ul>
                </div>
                <div class="clearfix"></div>
            </div>
            <ul class="nav nav-pills topnav">
                <li role="presentation"><a href="index.html">首页</a></li>
                <li role="presentation" class="active kzper1" style="display:none;"><a href="scraplist.html">整车报废</a></li>
                <li role="presentation" class="kzper2" style="display:none;"><a href="reclaimlist.html">旧件回收</a></li>
                <li role="presentation"><a href="partstrading.html">配件交易</a></li>
                <li role="presentation"><a href="auctionhouse.html">拍卖大厅</a></li>
                <li role="presentation"><a href="questions.html">常见问题</a></li>
                <li role="presentation"><a href="aboutus.html">关于我们</a></li>
                <li role="presentation"><a href="mycenter.html">个人中心</a></li>
            </ul>
        </div>
    </div>
    <div class="formbox">
        <div class="tablebox">
            <ol class="breadcrumb">
                <li><a href="scraplist.html">整车报废</a></li>
                <li class="active">订单详情</li>
            </ol>
            <!--流程图-->
            <div class="process">
                <div class="processbox">
                    <ul>
                        <li class="finish"><span class="circular">1</span><p>提交车辆信息</p></li>
                        <li class="qiu2"><span class="circular">2</span><p>上门取车</p></li>
                        <li class="qiu3"><span class="circular">3</span><p>车辆入场</p></li>
                        <li class="qiu4"><span class="circular">4</span><p>报废完成</p></li>
                        <li class="qiu5"><span class="circular">5</span><p>发放车辆残值款</p></li>
                    </ul>
                </div>
                <div style="padding-top:50px;">
                    <div class="progress">
                        <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 20%;">
                            <span class="sr-only">60% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
            <!--end 流程图-->
            <div class="row">
                <!--车辆信息-->
                <div class="col-md-6" style="min-height:600px;">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">车牌号：</th>
                            <td><span id="carnum"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车架号：</th>
                            <td><span id="carjia"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆型号：</th>
                            <td><span id="carxing"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">能否行驶：</th>
                            <td><span id="isdrive"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆归属：</th>
                            <td><span id="carAscription"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车主姓名：</th>
                            <td><span id="carOwner"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">车辆与手续照片：</th>
                            <td>
                                <div class="row displaypics">
                                    <!-- <div class="col-xs-4 col-md-4"> -->
                                    <!-- <div class="thumbnail"> -->
                                    <!-- <!--<img src="pic/pic1.jpg" alt="" />--> -->
                                    <!-- <p class="m-t-10 text-center text-primary">左向45度</p> -->
                                    <!-- </div> -->
                                    <!-- </div> -->
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <!--end 车辆信息-->
                <!--残值发放信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 残值发放信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">收款人姓名：</th>
                            <td><span id="payeeName"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">银行账户：</th>
                            <td><span id="bankAccount"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">开户行：</th>
                            <td><span id="openingBank"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">残值金额：</th>
                            <td>
                                <span id="orderAmount"></span>
                                <span class="label label-success" id="amountstate"></span>
                            </td>
                        </tr>
                    </table>
                </div>
                <!--end 残值发放信息-->
                <!--取车信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 取车信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">取车联系人：</th>
                            <td><span id="takeCarContacts"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">联系人电话：</th>
                            <td><span id="takeCarContactNumber"></span></td>
                        </tr>

                        <tr>
                            <th width="120" class="text-right">取车时间：</th>
                            <td><span id="takeCarTime"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">取车地址：</th>
                            <td><span id="takeCarAddress"></span></td>
                        </tr>
                    </table>
                </div>
                <!--end 取车信息-->
                <!--手续邮寄信息-->
                <div class="col-md-6">
                    <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 手续邮寄信息</h4>
                    <table class="tablelist">
                        <tr>
                            <th width="120" class="text-right">收件人姓名：</th>
                            <td><span id="mailingAddressName"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">收件人电话：</th>
                            <td><span id="mailingAddressTelephone"></span></td>
                        </tr>

                        <tr>
                            <th width="120" class="text-right">邮寄地址：</th>
                            <td><span id="detailedAddress"></span></td>
                        </tr>
                        <tr>
                            <th width="120" class="text-right">快递单号：</th>
                            <td>
                                <span class="label label-primary" id="expressCompany"></span>
                                <span id="expressNumber"></span>
                            </td>
                        </tr>
                    </table>
                </div>
                <!--end 手续邮寄信息-->
            </div>
            <div class="page-header"></div>
            <div class="text-center">
                <a id="CanceIndent" style="display:none;" class="btn btn-default btn-lg">取消订单</a>
                <a href="scrap.html" class="btn btn-default btn-lg goback">&#12288;返回&#12288;</a>
            </div>
        </div>
    </div>
    <script src="../js/modal.js" type="text/javascript"></script>
    <script src="../js/comm.js" type="text/javascript"></script>
    <script src="../layui/layui.all.js"></script>
    <script>
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);
        var id = $.getUrlParam('id');
        LoadPageDetail(id);
        function LoadPageDetail(id) {
            $.ajax({
                type: "get",
                url: href + 'order/' + id,
                dataType: "json",
                async: false,
                success: function (obj) {
                    if (obj.code == "201") {
                        layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "login.html";
                        });
                        return false;
                    }
                    if (obj.msg == "success") {
                        console.log(obj);
                        var info = obj.data;
                        $("#carnum").html(info.carNumber);
                        $("#carjia").html(info.carFrameNumber);
                        $("#carxing").html(info.carModelNumber);
                        $("#isdrive").html(info.isdrive == "1" ? "可以行驶" : (info.isdrive == "2" ? "不可以行驶" : "严重事故"));
                        $("#carAscription").html(info.carAscription == "1" ? "个人" : "公户");
                        $("#carOwner").html(info.carOwner);
                        $("#payeeName").html(info.payeeName);
                        $("#bankAccount").html(info.bankAccount);
                        $("#openingBank").html(info.openingBank);
                        $("#orderAmount").html(info.orderAmount);
                        $("#amountstate").html(GetAmountState(info.orderStatus));
                        $("#takeCarContacts").html(info.takeCarContacts);
                        $("#takeCarContactNumber").html(info.takeCarContactNumber);
                        $("#takeCarTime").html(info.takeCarTime);
                        $("#takeCarAddress").html(info.takeCarAddress);
                        $("#mailingAddressName").html(info.mailingAddressName);
                        $("#mailingAddressTelephone").html(info.mailingAddressTelephone);
                        //loadaddress(info.province, info.city, info.county, info.detailedAddress);
                        $("#expressCompany").html(info.expressCompany);
                        $("#expressNumber").html(info.expressNumber);
                        var pics = info.vehiclePictures;
                        var picinfo = "";
                        for (i = 0; i < pics.length; i++) {
                            picinfo += '<div class="col-xs-4 col-md-4">';
                            picinfo += '<div class="thumbnail">';
                            picinfo += '<img src="' + pics[i].url + '" alt="" />';
                            picinfo += '<p class="m-t-10 text-center text-primary">' + GetPicCategory(pics[i].carPictureType) + '</p>';
                            picinfo += '</div>';
                            picinfo += '</div>';
                        }
                        pics = info.formalitiesPictures;
                        for (i = 0; i < pics.length; i++) {
                            picinfo += '<div class="col-xs-4 col-md-4">';
                            picinfo += '<div class="thumbnail">';
                            picinfo += '<img src="' + pics[i].url + '" alt="" />';
                            picinfo += '<p class="m-t-10 text-center text-primary">' + GetPicCategory(pics[i].carPictureType) + '</p>';
                            picinfo += '</div>';
                            picinfo += '</div>';
                        }
                        $("#detailedAddress").html(LoadProvince(info.province) + LoadCity(info.city) + LoadArea(info.county) + info.detailedAddress);
                        //加载图片
                        $(".displaypics").html(picinfo);
                        //加载进度条
                        GetOrderType(info.orderStatus);
                        $(".thumbnail img").zoomify();
                    }
                }
            })
        }

        //加载省份
        function LoadProvince(a) {
            var result = "";
            if (a) {
                $.ajax({
                    type: "get",
                    url: href + 'dictionary/getProvince/' + a,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.msg == "success") {
                            result += obj.data.province;
                        }
                    }
                });
            }
            return result;
        }
        //加载城市
        function LoadCity(b) {
            var result = "";
            if (b) {
                $.ajax({
                    type: "get",
                    url: href + 'dictionary/getCity/' + b,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.code == "201") {
                            layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "login.html";
                            });
                            return false;
                        }
                        if (obj.msg == "success") {
                            result += obj.data.city;
                        }
                    }
                });
            }
            return result;
        }
        //加载区域
        function LoadArea(c) {
            var result = "";
            if (c) {
                $.ajax({
                    type: "get",
                    url: href + 'dictionary/getTbAreas/' + c,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.code == "201") {
                            layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "login.html";
                            });
                            return false;
                        }
                        if (obj.msg == "success") {
                            result += obj.data.area;
                        }
                    }
                });
            }
            return result;
        }

        //根据订单状态返回残值金额状态 1,2,3,4,5 未支付 6：部分支付 7：已支付 8：订单异常
        function GetAmountState(a) {
            var result = "";
            if (a == "1" || a == "2" || a == "3" || a == "4" || a == "5") {
                result = "未支付";
            }
            else if (a == "6") {
                result = "部分支付";
            }
            else if (a == "7") {
                result = "已支付";
            }
            else {
                result = "订单异常";
            }
            return result;
        }

        //加载图片所属类型
        function GetPicCategory(a) {
            var result = "";
            switch (a) {
                case "1": result = "左前45度"; break;
                case "2": result = "正前"; break;
                case "3": result = "右前45度 "; break;
                case "4": result = "左后45度"; break;
                case "5": result = "正后"; break;
                case "6": result = "右后45度"; break;
                case "7": result = "车架号"; break;
                case "8": result = "发动机"; break;
                case "9": result = "仪表"; break;
                case "10": result = "行驶证"; break;
                case "11": result = "登记证"; break;
                case "12": result = "车主身份正正前方"; break;
                case "13": result = "车主身份正正后"; break;
                default: result = "";
            }
            return result;
        }

        //根据订单状态返回页面进度条
        //订单状态：1，2:提交订单 3：上门取车 4：车辆审核 5出具车辆报废证明 6放款车辆残值 7：结束
        function GetOrderType(a) {
            if (localStorage.userType == 1) {
                if (a == "11" || a == "12"){
                    $("#CanceIndent").show();
                }
            }
            else {
                if (a == "1") {
                    $("#CanceIndent").show();
                }
            }
            if (a == "3") {
                $(".progress-bar-warning").css("width", "40%");
                $(".qiu2").addClass("finish");
            }
            else if (a == "4") {
                $(".progress-bar-warning").css("width", "60%");
                $(".qiu2").addClass("finish");
                $(".qiu3").addClass("finish");
            }
            else if (a == "5") {
                $(".progress-bar-warning").css("width", "80%");
                $(".qiu2").addClass("finish");
                $(".qiu3").addClass("finish");
                $(".qiu4").addClass("finish");
            }
            else if (a == "7") {
                $(".progress-bar-warning").css("width", "100%");
                $(".qiu2").addClass("finish");
                $(".qiu3").addClass("finish");
                $(".qiu4").addClass("finish");
                $(".qiu5").addClass("finish");
            }
        }

        //返回
        $(".goback").on("click", function (event) {
            event.preventDefault();
            window.history.go(-1)
        });
        $("#CanceIndent").on("click", function (event) {
            var html = '<div><div><textarea row="4" id="CanceRemarkID" style="width:100%;resize:none;height:110px;" placeholder="请输入取消原因" maxlength="500"></textarea></div><div><a href="javascript:AddRemark(\'价格太低\')" style="margin:10px;width:89px;" class="btn btn-primary">价格太低</a><a href="javascript:AddRemark(\'取车太慢\')" style="margin:10px;width:89px;" class="btn btn-primary">取车太慢</a><a href="javascript:AddRemark(\'卖给别人了\')" style="margin:10px;width:89px;" class="btn btn-primary">卖给别人了</a></div><div><a href="javascript:AddRemark(\'不想报废\')" style="margin-left:10px;width:89px;" class="btn btn-primary">不想报废</a><a href="javascript:AddRemark(\'发错了\')" style="margin-left:20px;width:89px;" class="btn btn-primary">发错了</a></div></div>';
            layer.open({
                type: 0,
                title: '取消订单',
                content: html,
                anim: 2,
                shade: 0,
                offset: "rb",
                area: ['400px', '330px'],
                btn: ['确定', '取消'],//按钮
                cancel: function () {
                    layer.close();
                },
                btn1: function (index, layero) {
                    var Remark = $("#CanceRemarkID").val();
                    if (Remark == "")
                    {
                        layer.msg("请输入取消原因！");
                        return false;
                    }
                    $.ajax({
                        type: "put",
                        url: href + "order/cancelOrder",
                        data: { id: id, cancelMemo: Remark },
                        dataType: "json",
                        success: function (data) {
                            if (data.code == "201") {
                                layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                                    time: 1000, //2s后自动关闭
                                }, function () {
                                    window.location.href = "login.html";
                                });
                                return false;
                            }
                            if (data.code == "200") {
                                if (data.data) {
                                    layer.msg("取消成功！", { time: 700 }, function () {
                                        window.location.href = document.referrer;
                                    });
                                }
                                else {
                                    layer.msg("取消失败！");
                                }
                            }
                            else {
                                layer.msg("数据异常！");
                            }
                        }
                    });
                }
            });
            // alert("取消订单");
        });
        function AddRemark(Remark)
        {
            var _Remark = $("#CanceRemarkID").val() + Remark+",";
            $("#CanceRemarkID").val(_Remark);
        }
    </script>
</body>
</html>
