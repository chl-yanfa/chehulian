<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../layui/css/layui.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <script src="../js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/jquery.bootstrap.min.js"></script>
    <script src="../js/dropdown.js" type="text/javascript"></script>
    <script src="../js/modal.js" type="text/javascript"></script>
    <script src="../layui/layui.all.js" type="text/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        a {
            text-decoration: none;
        }

            a:hover {
                text-decoration: none;
            }

        .tcdPageCode {
            padding: 15px 20px;
            text-align: left;
            color: #ccc;
            text-align: center;
        }

            .tcdPageCode a {
                display: inline-block;
                color: #428bca;
                display: inline-block;
                height: 25px;
                line-height: 25px;
                padding: 0 10px;
                border: 1px solid #ddd;
                margin: 0 2px;
                border-radius: 4px;
                vertical-align: middle;
            }

                .tcdPageCode a:hover {
                    text-decoration: none;
                    border: 1px solid #428bca;
                }

            .tcdPageCode span.current {
                display: inline-block;
                height: 25px;
                line-height: 25px;
                padding: 0 10px;
                margin: 0 2px;
                color: #fff;
                background-color: #428bca;
                border: 1px solid #428bca;
                border-radius: 4px;
                vertical-align: middle;
            }

            .tcdPageCode span.disabled {
                display: inline-block;
                height: 25px;
                line-height: 25px;
                padding: 0 10px;
                margin: 0 2px;
                color: #bfbfbf;
                background: #f2f2f2;
                border: 1px solid #bfbfbf;
                border-radius: 4px;
                vertical-align: middle;
            }

        .tijia {
            display: inline-block;
            width: 100px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        .tdmain td, th {
            text-align: center;
            vertical-align: middle;
        }
    </style>
    <title>车报废管理后台</title>
    <script type="text/javascript">
        $('.dropdown-toggle').dropdown()
    </script>
</head>
<body>
    <div class="back-stage-top">
        <h1 class="pull-left">车报废管理后台</h1>
        <h1 class="pull-right text-primary" id="loginout" style="margin-left:20px;cursor:pointer;font-size:18px;margin-right:50px;" onclick="loginout()">退出</h1>
        <h1 class="pull-right text-primary" id="loginusername" style="margin-left:20px;font-size:18px;">用户名：张三</h1>
    </div>
    <div class="backnav">
        <ul class="backnav" id="backnavper">
            <li class="displaynone"><a href="index.html">首页</a></li>
            <li class=""><a href="Inquiry.html">询价管理</a></li>
            <li class="displaynone"><a href="orderquotelist.html">报价管理</a></li>
            <li class="displaynone"><a href="orderlist.html">订单管理</a></li>
            <li class="displaynone"><a href="scraplist.html">整车报废</a></li>
            <li class="cur displaynone"><a href="jiulist.html">旧件回收</a></li>
            <li class="displaynone"><a href="moneymanage.html">财务管理</a></li>
            <li class="displaynone"><a href="system.html">系统管理</a></li>
        </ul>
    </div>
    <div class="tablebox">
        <div class="">
            <ol class="breadcrumb">
                <li><a href="index.html">首页</a></li>
                <li>旧件回收</li>
            </ol>
            <div class="searchbox">
                <div class="col-md-6">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchval" placeholder="订单编号/车牌号/车架号/描述/联系人/联系电话" />
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button" id="searbtn"  data-url="autoparts">查询</button>
                        </span>
                    </div>
                </div>
                <div class="pull-right">
                    <select class="img-input">
                        <option>全部订单类型</option>
                        <option>整车报废订单</option>
                        <option>旧件回收订单</option>
                    </select>
                </div>
                <div class="clearfix"></div>
            </div>
            <ul class="nav nav-tabs">
                <li role="presentation" class="active"><a href="#" data-type="" data-url="autoparts" class="changeye">全部</a></li>
                <li role="presentation"><a href="#" data-type="1" data-url="autoparts" class="changeye">未接单</a></li>
                <li role="presentation"><a href="#" data-type="2" data-url="autoparts" class="changeye">等待取回</a></li>
                <li role="presentation"><a href="#" data-type="3,5,6,7" data-url="autoparts" class="changeye">等待发放残值</a></li>
                <li role="presentation"><a href="#" data-type="8" data-url="autoparts" class="changeye">已完成</a></li>
                <li role="presentation"><a href="#" data-type="4" data-url="autoparts" class="changeye">无法取回</a></li>

            </ul>
            <table class="table table-striped tdmain">
                <thead>
                    <tr>
                        <th width="80">配件分类</th>
                        <th width="100">配件名称</th>
                        <th width="100">车型</th>
                        <th width="120">车架号</th>
                        <th width="80">车牌号</th>
                        <th width="120">委托方</th>
                        <th width="90">残值价格</th>
                        <th width="150">订单时间</th>
                        <th width="100">报案号</th>
                        <th width="100">状态</th>
                        <th width="80">操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="page" style="background: #fff;">
                <div class="tcdPageCode"></div>
            </div>
        </div>
    </div>

    <script src="../js/jquery.page.js"></script>
    <script src="../js/comm.js"></script>
    <script>
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);

        var type = $.getUrlParam('type');
        if (type == "1") {
            indexInfo();
        }
        else {
            showdata(1, "", "", 'autoparts');
        }

        //加载首页进来列表
        function indexInfo() {
            var lis = $(".nav-tabs li");
            lis.siblings().removeClass("active");
            for (var i = 0; i < lis.length; i++) {
                if ($(lis[i]).text().indexOf("等待取回") >= 0) {
                    $($(lis[i])).addClass("active");
                }
            }
            showdata(1, "2", "", "autoparts");
        }

        var typedata = "";
        var typeurl = "";
        //点击切换数据
        $(".changeye").on("click", function (event) {
            event.preventDefault();
            $(this).parent().siblings().removeClass("active");
            $(this).parent().addClass("active");
            var type = $(this).attr("data-type");
            var url = $(this).attr("data-url");
            var val = $("#searchval").val();
            showdata(1, type, val, url);
        });
        $("#searbtn").on("click", function (event) {
            event.preventDefault();
            var val = $("#searchval").val();
            showdata(1, typedata, val, "autoparts");
        });
        function showdata(x, y, z, h) {
            typedata = y;
            typeurl = h;
            $.ajax({
                type: "get",
                url: href + h,
                data: {
                    page: x,
                    rows: 10,
                    orderStatus: y,
                    keyWord: z
                },
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    if (data.code == "201") {
                        layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "login.html";
                        });
                        return false;
                    }
                    if (data.msg == "success") {
                        var otr = "";
                        var d = data.data.rows;
                        if (d.length) {
                            for (var i = 0; i < d.length; i++) {
                                otr += '<tr>'
                                otr += '<td>' + d[i].partsCaregoryName + '</td>'
                                otr += '<td><span data-id="' + d[i].id + '" class="chakan" style="color:blue;cursor:pointer">' + d[i].partsTypeName + '</span></td>'
                                otr += '<td><span class="tijia" title="' + d[i].carModelNumberName + '">' + d[i].carModelNumberName + '</span></td>'
                                otr += '<td>' + d[i].carFrameNumber + '</td>'
                                otr += '<td>' + d[i].carNumber + '</td>'
                                otr += '<td><span class="tijia" title="' + d[i].custormName + '">' + d[i].custormName + '</span></td>'
                                otr += '<td>' + d[i].orderAmount + '</td>'
                                otr += '<td>' + d[i].orderTime + '</td>'
                                otr += '<td>' + d[i].reportNo + '</td>'
                                otr += '<td>' + GetOldStateMsg(d[i].orderStatus) + '</td>'
                                otr += '<td><button role="button" class="btn btn-default btn-sm cha" data-id="' + d[i].id + '" >'
                                otr += '<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>编辑 </button>'
                                otr += '</td></tr>'
                            }
                        } else {
                            otr = '<tr><td colspan=' + $(".tdmain th").length + ' style="text-align:center">无数据</td></tr>'
                        }
                        $(".tdmain tbody").html(otr);
                        for (var i = 0; i < $(".tdmain td").length; i++) {
                            if ($(".tdmain td").eq(i).text() == null || $(".tdmain td").eq(i).text() == "null") {
                                $(".tdmain td").eq(i).html("")
                            }
                        }
                        $(".page").html("");
                        $(".page").html('<div class="tcdPageCode"></div>');
                        $(".tcdPageCode").createPage({
                            pageCount: Math.ceil(data.data.total / 10),
                            current: x,
                            backFn: function (p) {
                                showdata2(p, y, z, h)
                            }
                        });
                    }

                }

            });
        };
        function showdata2(x, y, z, h) {
            typedata = y;
            typeurl = h;
            $.ajax({
                type: "get",
                url: href + h,
                data: {
                    page: x,
                    rows: 10,
                    orderStatus: y,
                    keyWord: z
                },
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    if (data.code == "201") {
                        layer.msg('<span style="font-size:20px">登录时效，请重新登录</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "login.html";
                        });
                        return false;
                    }
                    if (data.msg == "success") {
                        var otr = "";
                        var d = data.data.rows;
                        if (d.length) {
                            for (var i = 0; i < d.length; i++) {
                                otr += '<tr>'
                                otr += '<td>' + d[i].partsCaregoryName + '</td>'
                                otr += '<td><span data-id="' + d[i].id + '" class="chakan" style="color:blue;cursor:pointer">' + d[i].partsTypeName + '</span></td>'
                                otr += '<td><span class="tijia" title="' + d[i].carModelNumberName + '">' + d[i].carModelNumberName + '</span></td>'
                                otr += '<td>' + d[i].carFrameNumber + '</td>'
                                otr += '<td>' + d[i].carNumber + '</td>'
                                otr += '<td><span class="tijia" title="' + d[i].custormName + '">' + d[i].custormName + '</span></td>'
                                otr += '<td>' + d[i].orderAmount + '</td>'
                                otr += '<td>' + d[i].orderTime + '</td>'
                                otr += '<td>' + d[i].reportNo + '</td>'
                                otr += '<td>' + GetOldStateMsg(d[i].orderStatus) + '</td>'
                                otr += '<td><button role="button" class="btn btn-default btn-sm cha" data-id="' + d[i].id + '" >'
                                otr += '<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>编辑 </button>'
                                otr += '</td></tr>'
                            }
                        } else {
                            otr = '<tr><td colspan=' + $(".tdmain th").length + ' style="text-align:center">无数据</td></tr>'
                        }
                        $(".tdmain tbody").html(otr);
                        for (var i = 0; i < $(".tdmain td").length; i++) {
                            if ($(".tdmain td").eq(i).text() == null || $(".tdmain td").eq(i).text() == "null") {
                                $(".tdmain td").eq(i).html("")
                            }
                        }
                        $(".page").html("");
                        $(".page").html('<div class="tcdPageCode"></div>');
                        $(".tcdPageCode").createPage({
                            pageCount: Math.ceil(data.data.total / 10),
                            current: x,
                            backFn: function (p) {
                                showdata(p, y, z, h)
                            }
                        });
                    }

                }

            });
        }
        //编辑
        $(document).delegate('.cha', 'click', function (event) {
            event.preventDefault();
            var id = $(this).attr("data-id");
            window.location.href = "edit-reclaim.html?id=" + id
        });
        //查看2
        $(document).delegate('.chakan', 'click', function (event) {
            event.preventDefault();
            var id = $(this).attr("data-id");
            window.location.href = "view-reclaim.html?id=" + id
        });
        clearnull();
    </script>
</body>
</html>
